{% extends "base.html" %}
{% block title %}{{ username }}„ÅÆ3‰ΩçÊõ≤ | Ê†πÊÄß„Ç´„É©„Ç™„Ç≠„É©„É≥„Ç≠„É≥„Ç∞{% endblock %}

{% block head %}
  <style>
    .table-wrap{overflow-x:auto}
    .col-date{min-width: 140px;}
    @media (max-width:720px){ .col-date{min-width: 160px;} }
    .score{ font-weight:900; letter-spacing:.2px; text-shadow:0 0 12px rgba(34,197,94,.18); }


    @media (max-width:768px){
      th, td { font-size:14px; padding:8px 10px; }
    }
    @media (max-width:480px){
      th, td { font-size:13px; padding:7px 8px; }
    }
  </style>
{% endblock %}

{% block content %}
  <div class="h1" style="display:flex; align-items:center; justify-content:space-between;">
    <span>{{ username }} „ÅÆ 3‰ΩçÊõ≤„É©„É≥„Ç≠„É≥„Ç∞</span>
    <div class="row" style="gap:8px">
      <a class="btn secondary" href="{{ url_for('user_history', username=username) }}" style="font-size:14px; padding:6px 12px;">Â±•Ê≠¥„Å∏</a>
      <a class="btn secondary" href="{{ url_for('ranking') }}" style="font-size:14px; padding:6px 12px;">Êõ≤Âà•„É©„É≥„Ç≠„É≥„Ç∞„Å∏</a>
    </div>
  </div>

  {% if ranking_cards %}
    {% for item in ranking_cards %}
      <div class="song card">
        <div class="song-head">
          <div>
            <div class="song-title">{{ item.song }}</div>
            {% if item.singer %}
              <div class="artist">Ê≠åÊâãÂêçÔºö<span class="chip">{{ item.singer }}</span></div>
            {% endif %}
          </div>
          <div class="muted" style="font-size:12px">Top 3</div>
        </div>

        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th style="width:60px">È†Ü‰Ωç</th>
                <th style="min-width:140px">„É¶„Éº„Ç∂„Éº</th>
                <th style="min-width:100px">„Çπ„Ç≥„Ç¢</th>
                <th class="col-date">Êó•‰ªò</th>
              </tr>
            </thead>
            <tbody>
              {% for record in item.records %}
                <tr>
                  <td class="rank">
                    {% if loop.index == 1 %}<span class="medal-1">ü•á 1‰Ωç</span>
                    {% elif loop.index == 2 %}<span class="medal-2">ü•à 2‰Ωç</span>
                    {% else %}<span class="medal-3">ü•â 3‰Ωç</span>{% endif %}
                  </td>
                  <td>{{ record["„É¶„Éº„Ç∂„Éº"] }}</td>
                  <td><span class="score">{{ '%.3f'|format(record["„Çπ„Ç≥„Ç¢"]) }}</span></td>
                  <td>{{ record["Êó•‰ªò"]|fmtdate }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="card">
      <div class="muted">3‰Ωç„ÅÆÊõ≤„ÅØ„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</div>
    </div>
  {% endif %}
{% endblock %}
