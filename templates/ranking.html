{% extends "base.html" %}
{% block title %}曲別ランキング | 根性カラオキランキング{% endblock %}

{% block update_hidden %}
  <input type="hidden" name="song" value="{{ song_query }}">
  <input type="hidden" name="singer" value="{{ singer_query }}">
{% endblock %}

{% block content %}
  <div class="h1">曲別ランキング</div>

  <form class="card" method="get" action="{{ url_for('ranking') }}" style="margin-bottom:16px">
    <div class="grid cols-3">
      <div>
        <label for="song">曲名検索</label>
        <input type="text" id="song" name="song" placeholder="例：PERFECT HUMAN" value="{{ song_query }}">
      </div>
      <div>
        <label for="singer">歌手名検索</label>
        <input type="text" id="singer" name="singer" placeholder="例：三浦たくま" value="{{ singer_query }}">
      </div>
    </div>
    <div class="row" style="margin-top:12px; justify-content:flex-end">
      <a class="btn secondary" href="{{ url_for('ranking') }}">条件クリア</a>
      <button class="btn" type="submit">検索</button>
    </div>
  </form>

  {% if ranking_data %}
    {% for song, records in ranking_data.items() %}
      <div class="song card">
        <div class="song-head">
          <div>
            <div class="song-title">{{ song }}</div>
            {% if records and records[0]["歌手名"] %}
              <div class="artist">歌手名：<span class="chip">{{ records[0]["歌手名"] }}</span></div>
            {% endif %}
          </div>
          <div class="muted" style="font-size:12px">Top 3</div>
        </div>

        <table>
          <thead>
            <tr>
              <th style="width:60px">順位</th>
              <th style="min-width:140px">ユーザー</th>
              <th style="min-width:100px">スコア</th>
              <th style="min-width:160px">日付</th>
            </tr>
          </thead>
          <tbody>
            {% for record in records %}
              <tr>
                <td class="rank">
                  {% if loop.index == 1 %}<span class="medal-1">🥇 1位</span>
                  {% elif loop.index == 2 %}<span class="medal-2">🥈 2位</span>
                  {% else %}<span class="medal-3">🥉 3位</span>{% endif %}
                </td>
                <td>{{ record["ユーザー"] }}</td>
                <td><strong style="font-size:1.1em; color:#22c55e">{{ '%.3f'|format(record["スコア"]) }}</strong></td>
                <td>{{ record["日付"].strftime('%Y-%m-%d %H:%M') if record["日付"] }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endfor %}
  {% else %}
    <div class="card">
      <div class="muted">ランキングデータはまだありません。右上の「ランキング更新」から取り込んでください。</div>
    </div>
  {% endif %}
{% endblock %}